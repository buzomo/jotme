<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüç°%3C/text%3E%3C/svg%3E"
      type="image/svg+xml"> <title>Daily Notes</title>
    <style>
      ::-webkit-scrollbar {
        display: none;
      }
      .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 20px;
      }
      .notes-container {
        display: flex;
        width: 100%;
        justify-content: space-between;
        margin-top: 20px;
      }
      .note-area {
        flex: 1;
        margin: 0 10px;
        border: 1px solid #ddd;
        padding: 10px;
        box-sizing: border-box;
      }
      .note-header {
        text-align: center;
        font-weight: bold;
        margin-bottom: 10px;
      }
      .text-box {
        height: 3500px;
      }
      textarea {
        border: none;
        outline: 0;
        box-sizing: border-box;
        width: 100%;
        color: inherit;
        background-color: inherit;
        line-height: 200%;
      }
      a {
        color: rgb(127, 197, 255);
      }
      .markdown-viewer,
      .text-box {
        font-family: "BIZ UDGothic";
        width: 100%;
        margin-top: 20px;
        border: none;
        padding: 5px;
        letter-spacing: 150%;
        font-size: large;
        line-height: 200%;
        word-break: break-all;
      }
      .markdown-viewer {
        display: none;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  </head>
  <body>
    <div class="container">
      <div class="notes-container">
        <div class="note-area" id="yesterdayArea">
          <div class="note-header" id="yesterdayHeader">Êò®Êó•</div>
          <textarea class="text-box" id="yesterdayBox"
            placeholder="„É°„É¢„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ..."></textarea>
          <div class="markdown-viewer" id="yesterdayViewer"></div>
        </div>
        <div class="note-area" id="todayArea">
          <div class="note-header" id="todayHeader">‰ªäÊó•</div>
          <textarea class="text-box" id="todayBox"
            placeholder="„É°„É¢„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ..."></textarea>
          <div class="markdown-viewer" id="todayViewer"></div>
        </div>
        <div class="note-area" id="tomorrowArea">
          <div class="note-header" id="tomorrowHeader">ÊòéÊó•</div>
          <textarea class="text-box" id="tomorrowBox"
            placeholder="„É°„É¢„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ..."></textarea>
          <div class="markdown-viewer" id="tomorrowViewer"></div>
        </div>
      </div>
    </div>
    <script>
      (() => {
        const elements = {
          yesterdayArea: document.getElementById("yesterdayArea"),
          todayArea: document.getElementById("todayArea"),
          tomorrowArea: document.getElementById("tomorrowArea"),
          yesterdayBox: document.getElementById("yesterdayBox"),
          todayBox: document.getElementById("todayBox"),
          tomorrowBox: document.getElementById("tomorrowBox"),
          yesterdayViewer: document.getElementById("yesterdayViewer"),
          todayViewer: document.getElementById("todayViewer"),
          tomorrowViewer: document.getElementById("tomorrowViewer"),
          yesterdayHeader: document.getElementById("yesterdayHeader"),
          todayHeader: document.getElementById("todayHeader"),
          tomorrowHeader: document.getElementById("tomorrowHeader"),
        };

        const state = {
          today: new Date(),
        };

        // Êó•‰ªò„Çí„Éï„Ç©„Éº„Éû„ÉÉ„Éà„Åó„Å¶Ë°®Á§∫
        const formatDate = (date) => {
          return `${date.getFullYear()}Âπ¥${String(date.getMonth() + 1).padStart(2, "0")}Êúà${String(date.getDate()).padStart(2, "0")}Êó• (${date.toLocaleDateString("ja-JP", { weekday: "long" })})`;
        };

        // „É°„É¢„Çí‰øùÂ≠ò
        const saveMemo = (date, content) => {
          const dateStr = date.toISOString().split("T")[0];
          localStorage.setItem(dateStr, content);
        };

        // „É°„É¢„ÇíË™≠„ÅøËæº„Åø
        const loadMemo = (date, box, viewer) => {
          const dateStr = date.toISOString().split("T")[0];
          const content = localStorage.getItem(dateStr) || "";
          box.value = content;
          viewer.innerHTML = marked.parse(content);
          viewer.style.display = content ? "block" : "none";
          box.style.display = content ? "none" : "block";
        };

        // Êó•‰ªò„Åî„Å®„ÅÆ„É°„É¢„ÇíÊõ¥Êñ∞
        const updateMemo = () => {
          const yesterday = new Date(state.today);
          yesterday.setDate(yesterday.getDate() - 1);
          const tomorrow = new Date(state.today);
          tomorrow.setDate(tomorrow.getDate() + 1);

          elements.yesterdayHeader.textContent = formatDate(yesterday);
          elements.todayHeader.textContent = formatDate(state.today);
          elements.tomorrowHeader.textContent = formatDate(tomorrow);

          loadMemo(yesterday, elements.yesterdayBox, elements.yesterdayViewer);
          loadMemo(state.today, elements.todayBox, elements.todayViewer);
          loadMemo(tomorrow, elements.tomorrowBox, elements.tomorrowViewer);
        };

        // „ÉÜ„Ç≠„Çπ„Éà„Éú„ÉÉ„ÇØ„Çπ„Å®„Éì„É•„Éº„Ç¢„ÅÆË°®Á§∫„ÇíÂàá„ÇäÊõø„Åà
        const toggleEditView = (box, viewer, isEdit) => {
          box.style.display = isEdit ? "block" : "none";
          viewer.style.display = isEdit ? "none" : "block";
        };

        // ÂàùÊúüÂåñ
        const init = () => {
          updateMemo();
        };

        // „Éì„É•„Éº„Ç¢„Çí„ÇØ„É™„ÉÉ„ÇØ„ÅßÁ∑®ÈõÜ„É¢„Éº„Éâ„Å´
        elements.yesterdayViewer.addEventListener("click", () => {
          toggleEditView(elements.yesterdayBox, elements.yesterdayViewer, true);
          elements.yesterdayBox.focus();
        });

        elements.todayViewer.addEventListener("click", () => {
          toggleEditView(elements.todayBox, elements.todayViewer, true);
          elements.todayBox.focus();
        });

        elements.tomorrowViewer.addEventListener("click", () => {
          toggleEditView(elements.tomorrowBox, elements.tomorrowViewer, true);
          elements.tomorrowBox.focus();
        });

        // „ÉÜ„Ç≠„Çπ„Éà„Éú„ÉÉ„ÇØ„Çπ„ÅÆ„Éï„Ç©„Éº„Ç´„Çπ„Ç¢„Ç¶„Éà„Ç§„Éô„É≥„Éà
        elements.yesterdayBox.addEventListener("blur", () => {
          const yesterday = new Date(state.today);
          yesterday.setDate(yesterday.getDate() - 1);
          saveMemo(yesterday, elements.yesterdayBox.value);
          elements.yesterdayViewer.innerHTML = marked.parse(elements.yesterdayBox.value);
          toggleEditView(elements.yesterdayBox, elements.yesterdayViewer, false);
        });

        elements.todayBox.addEventListener("blur", () => {
          saveMemo(state.today, elements.todayBox.value);
          elements.todayViewer.innerHTML = marked.parse(elements.todayBox.value);
          toggleEditView(elements.todayBox, elements.todayViewer, false);
        });

        elements.tomorrowBox.addEventListener("blur", () => {
          const tomorrow = new Date(state.today);
          tomorrow.setDate(tomorrow.getDate() + 1);
          saveMemo(tomorrow, elements.tomorrowBox.value);
          elements.tomorrowViewer.innerHTML = marked.parse(elements.tomorrowBox.value);
          toggleEditView(elements.tomorrowBox, elements.tomorrowViewer, false);
        });

        // „ÉÜ„Ç≠„Çπ„Éà„Éú„ÉÉ„ÇØ„Çπ„ÅÆ„Ç≠„Éº„ÉÄ„Ç¶„É≥„Ç§„Éô„É≥„ÉàÔºà„É™„Çπ„Éà„ÉªË¶ãÂá∫„ÅóË£úÂÆåÔºâ
        const setupTextBoxKeyDown = (box) => {
          box.addEventListener("keydown", (e) => {
            const t = box.selectionStart;
            const a = box.value.substring(0, t);
            const l = a.split("\n");
            const n = l.length - 1;
            const o = l[n];
            const r = o.match(/^(\s*)- /);

            if ("Tab" === e.key) {
              e.preventDefault();
              const t = box.selectionStart;
              const a = box.selectionEnd;
              const l = box.value.slice(0, t);
              const n = box.value.slice(t, a);
              const o = box.value.slice(a);
              const r = l.lastIndexOf("\n") + 1;
              const c = a + o.indexOf("\n");
              const i = box.value.slice(r, c).split("\n");

              if (e.shiftKey) {
                const e = i.map((e) => e.startsWith("  ") ? e.slice(2) : e).join("\n");
                box.value = box.value.slice(0, r) + e + box.value.slice(c);
                const a = t - 2 * i.filter((e) => e.startsWith("  ")).length;
                box.selectionStart = a;
                box.selectionEnd = a;
              } else {
                const e = i.map((e) => "  " + e).join("\n");
                box.value = box.value.slice(0, r) + e + box.value.slice(c);
                const a = t + 2 * i.length;
                box.selectionStart = a;
                box.selectionEnd = a;
              }
            }

            if ("Enter" === e.key) {
              if (r) {
                e.preventDefault();
                const n = r[1];
                const c = box.value.substring(t);
                if ("-" === o.trim()) {
                  l.pop();
                  const e = l.join("\n") + "\n" + c;
                  box.value = e;
                  box.selectionStart = box.selectionEnd = t - o.length + 1;
                } else {
                  const e = a + "\n" + n + "- " + c;
                  box.value = e;
                  box.selectionStart = box.selectionEnd = t + n.length + 3;
                }
              } else {
                const c = o.match(/^#\s/);
                if (c && o.trim().length > 2) {
                  e.preventDefault();
                  const l = a + "\n- " + box.value.substring(t);
                  box.value = l;
                  box.selectionStart = box.selectionEnd = t + 4;
                } else if (n > 1) {
                  e.preventDefault();
                  const l = a + "\n\n# " + box.value.substring(t);
                  box.value = l;
                  box.selectionStart = box.selectionEnd = t + 6;
                }
              }
            } else if ("Backspace" === e.key) {
              if ("-" === o.trim()) {
                e.preventDefault();
                l.pop();
                const a = l.join("\n") + box.value.substring(t);
                box.value = a;
                box.selectionStart = box.selectionEnd = t - o.length;
              }
            } else if ("#" === e.key && "" === o) {
              e.preventDefault();
              const l = a + "# " + box.value.substring(t);
              box.value = l;
              box.selectionStart = box.selectionEnd = t + 2;
            }
          });
        };

        // ÂêÑ„ÉÜ„Ç≠„Çπ„Éà„Éú„ÉÉ„ÇØ„Çπ„Å´„Ç≠„Éº„ÉÄ„Ç¶„É≥„Ç§„Éô„É≥„Éà„ÇíË®≠ÂÆö
        setupTextBoxKeyDown(elements.yesterdayBox);
        setupTextBoxKeyDown(elements.todayBox);
        setupTextBoxKeyDown(elements.tomorrowBox);

        // ÂàùÊúüÂåñ
        init();
      })();
    </script>
  </body>
</html>
